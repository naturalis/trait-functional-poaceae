## Scripts
This directory contains several Shell and R scripts intended to query data from the Encyclopedia of Life (EoL)
and analyse this data into usable results.

**NOTE**: for the shell scripts named `traitAnalyser.sh` and `traitGetData.sh` an additional file is required.
Please make sure to add a file named `eol.token` within this directory.
This file needs to contain your Encyclopedia of Life token, which can be acquired with the method
described [here](https://github.com/EOL/eol_website/blob/master/doc/api.md).

This file needs to ONLY contain your token, with nothing else, in this way:
```
eyJ0eXAzczOzJZUzZ1NzJ9.eyJ1c2VyZjoTA1QWJsZzfQ.Xf5FSA2P_lJBGyBYGTsRPczAkg
```
(please note this is an example token)


### [traitAnalyser.sh](https://github.com/naturalis/trait-functional-poaceae/blob/main/scripts/traitAnalyser.sh)
This script is made for collecting all traits recorded for each of the children of a page with `page_id` in the Encyclopedia of Life.
It will return a list in Comma Separated Value format with the following columns:
1. `trait`: This contains the name of the trait (or predicate) as listed on the EoL.
2. `total_occurrence`: Some organism entries may have multiple records of a single trait. This column contains the cumulative count of these.
3. `unique_occurrence`: Unlike `total_occurrence`, this column stores one for every trait an organism has, and is **not** cumulative.
4. `uri`: This has the URI address where the EoL has retrieved this data from.
5. `definition`: The definition of the trait, as defined by the ontology, is stored here.
6. `comment`: An optional note added by the EoL curators.

### [traitGetData.sh](https://github.com/naturalis/trait-functional-poaceae/blob/main/scripts/traitGetData.sh)
This script contains a query to fetch all record data of the Seed Dry Mass predicate of all children of a page with `page_id` from the Encyclopedia of Life.
It will return a list in Comma Separated Value format with the following columns:
1. `id`: The EOL Page ID of an organism.
2. `organism`: This column contains the scientific name of the organism.
3. `trait`: This contains the name of the trait (or predicate) as listed on the EoL.
4. `measurement`: The value of the measurement of Seed Dry Mass is stored here.
5. `unit`: The unit the measurement in column 3 is recorded in.
6. `source`: The source of the trait data.

### seedmass_wf
This is an R Markdown file. This file contains the statistical analysis conducted on the seed mass.
This file is available as the [raw R Markdown](https://github.com/naturalis/trait-functional-poaceae/blob/main/scripts/seedmass_wf.Rmd) in the .Rmd file, or in a [pdf report](https://github.com/naturalis/trait-functional-poaceae/blob/main/scripts/seedmass_wf.pdf) generated using the R Markdown file.
As input to this workflow is one of the seedmasses files from the `/data` directory, and a table of species with their environmental variables created in a study by Esther de Regt, which can be found [here](https://github.com/naturalis/angiosperm-traits/blob/master/raw_means.csv). This table was downloaded locally and also put in the `/data` directory as `raw_means.csv`
The figures generated by this file can be found in the [/results](https://github.com/naturalis/trait-functional-poaceae/tree/main/results) directory.
<br>
This analysis was initially run with R version 4.1.0, and required the following packages:

|Package      |Version  |Dependency of  |
|-------------|---------|---------------|
|ape          |5.5      |phylolm        |
|ggplot2      |3.3.5    |-              |
|ggtree       |3.0.2    |-              |
|phylobase    |0.8.10   |-              |
|phylolm      |2.6.2    |-              |
|phylosignal  |1.3      |-              |
|raster       |3.4-13   |usdm           |
|sp           |0.3.4    |usdm           |
|tidytree     |1.4-5    |treeio, ggtree |
|treeio       |1.16.1   |-              |
|usdm         |1.1-18   |-              |

### seedmass_PCA.r
This is a r script that performs a PCA and stepwise fylogenetic analysis with the seedmass and environmental data from Poaceae species. The input of script are the files poaceae_seedmass.csv, raw_means.csv and ALLBM.tre.txt. Theses files can be found in the `/data` directory. The figures created by this R script can be found in the `/results` directory.
<br>
The packages required to run this R script are as followed:
|Package      |Version used  |Dependency of  |
|-------------|--------------|---------------|
|ape          |5.6-2         |phylolm        |
|ggplot2      |3.3.5         |-              |
|factoextra   |1.0.7         |ggplot2        |
|phylolm      |2.6.2         |-              |
